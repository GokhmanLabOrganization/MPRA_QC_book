# Activity QC



```{r, echo=FALSE}
library(png)
library(grid)

```

```{r, echo=FALSE}
working_dir="/home/labs/davidgo/Collaboration/MPRA_QC_pipeline/activity/output"
output_dir=sprintf("%s/test_QC",working_dir)
verbose = TRUE

print_examples <- function(good_example, bad_example, bad_example2 = NULL) {
  if (exists("verbose", envir = .GlobalEnv) && get("verbose", envir = .GlobalEnv)) {
    cat("Good example:", good_example, "\n")
    cat("Bad example:", bad_example, "\n")
    if (!is.null(bad_example2)) {
      cat("Bad example 2:", bad_example2, "\n")
    }
  }
}

plot_single <- function(example) {
  # Start new page
  grid::grid.newpage()
  
  # Draw the image directly (no layout needed for one plot)
  grid::grid.raster(example, interpolate = FALSE)
}


plot_side_by_side <- function(good_example, bad_example) {
  # Start new page and define layout
  grid::grid.newpage()
  grid::pushViewport(grid::viewport(layout = grid::grid.layout(1, 2)))
  
  # Helper to specify location in layout
  vplayout <- function(row, col) grid::viewport(layout.pos.row = row, layout.pos.col = col)
  
  # Draw both images in the layout without using print()
  grid::pushViewport(vplayout(1, 1))
  grid::grid.raster(good_example, interpolate = FALSE)
  grid::popViewport()
  
  grid::pushViewport(vplayout(1, 2))
  grid::grid.raster(bad_example, interpolate = FALSE)
  grid::popViewport()
}


plot_three_side_by_side <- function(good_example, bad_example1, bad_example2) {
  # Start new page and define layout
  grid::grid.newpage()
  grid::pushViewport(grid::viewport(layout = grid::grid.layout(1, 3)))
  
  # Helper to specify location in layout
  vplayout <- function(row, col) grid::viewport(layout.pos.row = row, layout.pos.col = col)
  
  # Draw images in the layout without using print()
  grid::pushViewport(vplayout(1, 1))
  grid::grid.raster(good_example, interpolate = FALSE)
  grid::popViewport()
  
  grid::pushViewport(vplayout(1, 2))
  grid::grid.raster(bad_example1, interpolate = FALSE)
  grid::popViewport()
  
  grid::pushViewport(vplayout(1, 3))
  grid::grid.raster(bad_example2, interpolate = FALSE)
  grid::popViewport()
}


```


## Evaluating DNA and RNA complexity
### Retained cCREs and barcodes
```{r,echo=FALSE}
good_example_MPRA = "PMID_38766054_Reilly"
bad_example_MPRA = "Max_MPRA_run2"
analysis_name = 'activity_distribution.png'
print_examples(good_example_MPRA, bad_example_MPRA)

good_example <- readPNG(file.path(working_dir,good_example_MPRA,analysis_name),native = T)
bad_example <- readPNG(file.path(working_dir, bad_example_MPRA, analysis_name),native = T)
plot_side_by_side(good_example,bad_example)

rm(good_example_MPRA,bad_example_MPRA,analysis_name)
```


### Activity distribution
```{r,echo=FALSE}

good_example_MPRA = "modern_humanMPRA_NPC"
bad_example_MPRA = "humanMPRA_L1a1_Neurons"
analysis_name = 'activity_distribution.png'
print_examples(good_example_MPRA, bad_example_MPRA)

good_example <- readPNG(file.path(working_dir,good_example_MPRA,analysis_name),native = T)
bad_example <- readPNG(file.path(working_dir, bad_example_MPRA, analysis_name),native = T)
plot_side_by_side(good_example,bad_example)

rm(good_example_MPRA,bad_example_MPRA,analysis_name)

```


### P-value distribution
```{r,echo=FALSE}

good_example_MPRA = "PMID_38766054_Reilly"
bad_example_MPRA = "Max_MPRA_run2"
analysis_name = 'P_value_distribution.png'
print_examples(good_example_MPRA, bad_example_MPRA)

good_example <- readPNG(file.path(working_dir,good_example_MPRA,analysis_name),native = T)
bad_example <- readPNG(file.path(working_dir, bad_example_MPRA, analysis_name),native = T)
plot_side_by_side(good_example,bad_example)

rm(good_example_MPRA,bad_example_MPRA,analysis_name)
```


### Downsampling analysis - active cCREs
```{r,echo=FALSE}

grid.newpage()

good_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T)
bad_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T)

# Start new page and define layout
grid.newpage()
pushViewport(viewport(layout = grid.layout(1, 2)))

# Helper to specify location in layout
vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col)

# Draw both images in the layout without using print()
pushViewport(vplayout(1, 1))
grid.raster(good_example, interpolate = FALSE)
popViewport()

pushViewport(vplayout(1, 2))
grid.raster(bad_example, interpolate = FALSE)
popViewport()

```


### Cumulative RNA reads
```{r,echo=FALSE}
good_example_MPRA = "PMID_38766054_Reilly"
bad_example_MPRA = "Max_MPRA_run2"
analysis_name = 'cumulative_RNA_reads.png'
print_examples(good_example_MPRA, bad_example_MPRA)

good_example <- readPNG(file.path(working_dir,good_example_MPRA,analysis_name),native = T)
bad_example <- readPNG(file.path(working_dir, bad_example_MPRA, analysis_name),native = T)
plot_side_by_side(good_example,bad_example)

rm(good_example_MPRA,bad_example_MPRA,analysis_name)

```


## Evaluating reproducibility
### Similarity between samples (PCA)
```{r,echo=FALSE}

grid.newpage()

good_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T)
bad_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T)

# Start new page and define layout
grid.newpage()
pushViewport(viewport(layout = grid.layout(1, 2)))

# Helper to specify location in layout
vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col)

# Draw both images in the layout without using print()
pushViewport(vplayout(1, 1))
grid.raster(good_example, interpolate = FALSE)
popViewport()

pushViewport(vplayout(1, 2))
grid.raster(bad_example, interpolate = FALSE)
popViewport()

```

### Correlation between replicates
```{r,echo=FALSE}

good_example_MPRA = "PMID_38766054_Reilly"
bad_example_MPRA = "humanMPRA_L1a1"
bad_example_MPRA_2 = "humanMPRA_L1a1_Neurons"
analysis_name = 'RNA_DNA_ratio_correlation_between_replicates.png'
print_examples(good_example_MPRA, bad_example_MPRA,bad_example_MPRA_2)

good_example <- readPNG(file.path(working_dir,good_example_MPRA,analysis_name),native = T)
bad_example <- readPNG(file.path(working_dir, bad_example_MPRA, analysis_name),native = T)
bad_example_2 <- readPNG(file.path(working_dir, bad_example_MPRA_2, analysis_name),native = T)
plot_three_side_by_side(good_example,bad_example,bad_example_2)

rm(good_example_MPRA,bad_example_MPRA,bad_example_MPRA_2,analysis_name)
```




### Variation at various activity levels
```{r,echo=FALSE}
grid.newpage()

good_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T)
bad_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T)

# Start new page and define layout
grid.newpage()
pushViewport(viewport(layout = grid.layout(1, 2)))

# Helper to specify location in layout
vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col)

# Draw both images in the layout without using print()
pushViewport(vplayout(1, 1))
grid.raster(good_example, interpolate = FALSE)
popViewport()

pushViewport(vplayout(1, 2))
grid.raster(bad_example, interpolate = FALSE)
popViewport()

```



### Correlation between replicates (controls)
```{r,echo=FALSE}
good_example_MPRA = "PMID_38766054_Reilly"
bad_example_MPRA = "humanMPRA_L1a1"
bad_example_MPRA_2 = "humanMPRA_L1a1_Neurons"
analysis_name = 'RNA_DNA_ratio_correlation_between_replicates_with_controls.png'
print_examples(good_example_MPRA, bad_example_MPRA,bad_example_MPRA_2)

good_example <- readPNG(file.path(working_dir,good_example_MPRA,analysis_name),native = T)
bad_example <- readPNG(file.path(working_dir, bad_example_MPRA, analysis_name),native = T)
bad_example_2 <- readPNG(file.path(working_dir, bad_example_MPRA_2, analysis_name),native = T)
plot_three_side_by_side(good_example,bad_example,bad_example_2)

rm(good_example_MPRA,bad_example_MPRA,bad_example_MPRA_2,analysis_name)
```

### Activity of controls - sample comparison
```{r,echo=FALSE}

example_MPRA = "humanMPRA_L3a2"
analysis_name = 'positive_controls_corr_between_libs_hMPRA.png'
example <- readPNG(file.path(working_dir,example_MPRA,analysis_name),native = T)


plot_single(example)
print(example_MPRA)
rm(example_MPRA,analysis_name)
```








### Activity of controls - sample comparison
```{r,echo=FALSE}
good_example_MPRA = "PMID_38766054_Reilly"
bad_example_MPRA = "Max_MPRA_run2"
analysis_name = 'Control_activity_boxplots.png'
print_examples(good_example_MPRA, bad_example_MPRA)

good_example <- readPNG(file.path(working_dir,good_example_MPRA,analysis_name),native = T)
bad_example <- readPNG(file.path(working_dir, bad_example_MPRA, analysis_name),native = T)
plot_side_by_side(good_example,bad_example)

rm(good_example_MPRA,bad_example_MPRA,analysis_name)

```

### Outlier barcodes + min(DNA)
```{r,echo=FALSE}

grid.newpage()

good_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T)
bad_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T)

# Start new page and define layout
grid.newpage()
pushViewport(viewport(layout = grid.layout(1, 2)))

# Helper to specify location in layout
vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col)

# Draw both images in the layout without using print()
pushViewport(vplayout(1, 1))
grid.raster(good_example, interpolate = FALSE)
popViewport()

pushViewport(vplayout(1, 2))
grid.raster(bad_example, interpolate = FALSE)
popViewport()

```


### Outlier barcodes
```{r,echo=FALSE}

grid.newpage()

good_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T)
bad_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T)

# Start new page and define layout
grid.newpage()
pushViewport(viewport(layout = grid.layout(1, 2)))

# Helper to specify location in layout
vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col)

# Draw both images in the layout without using print()
pushViewport(vplayout(1, 1))
grid.raster(good_example, interpolate = FALSE)
popViewport()

pushViewport(vplayout(1, 2))
grid.raster(bad_example, interpolate = FALSE)
popViewport()

```




<!-- ############################ -->

<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir, "humanMPRA_L3a2", "Control_activity_boxplots.png"),native = T) -->

<!-- bad_example_1 <- readPNG(file.path(working_dir, "humanMPRA_L1a1_Neurons", "Control_activity_boxplots.png"),native = T) -->
<!-- bad_example_2 <- readPNG(file.path(working_dir, "archaic_MPRA", "Control_activity_boxplots.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 3))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example_1, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 3)) -->
<!-- grid.raster(bad_example_2, interpolate = FALSE) -->
<!-- popViewport() -->
<!-- ``` -->

<!-- ## RNA/DNA ratio correlation between replicates - subgroup -->

<!-- Lorem Ipsum -->


<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T) -->
<!-- bad_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 2))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- ``` -->

<!-- ## RNA vs. DNA scatter plot -->

<!-- Lorem Ipsum -->


<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir, "humanMPRA_L3a2", "RNA_DNA_ratio.png"),native = T) -->
<!-- bad_example_1 <- readPNG(file.path(working_dir, "humanMPRA_L1a1", "RNA_DNA_ratio.png"),native = T) -->
<!-- bad_example_2 <- readPNG(file.path(working_dir, "humanMPRA_L1a1_Neurons", "RNA_DNA_ratio.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 3))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example_1, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 3)) -->
<!-- grid.raster(bad_example_2, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- ``` -->


<!-- ## RNA vs. DNA scatter plot - group of interest - Controls -->

<!-- Lorem Ipsum -->

<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir, "humanMPRA_L3a2", "RNA_DNA_ratio_w_controls_highlighted.png"),native = T) -->
<!-- bad_example_1 <- readPNG(file.path(working_dir, "humanMPRA_L1a1", "RNA_DNA_ratio_w_controls_highlighted.png"),native = T) -->
<!-- bad_example_2 <- readPNG(file.path(working_dir, "humanMPRA_L1a1_Neurons", "RNA_DNA_ratio_w_controls_highlighted.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 3))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example_1, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 3)) -->
<!-- grid.raster(bad_example_2, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- ``` -->


<!-- ## RNA vs. DNA scatter plot - group of interest - Active vs Non-active -->

<!-- Lorem Ipsum -->


<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir, "humanMPRA_L3a2", "RNA_DNA_ratio_active_oligos_highlighted.png"),native = T) -->
<!-- bad_example_1 <- readPNG(file.path(working_dir, "humanMPRA_L1a1", "RNA_DNA_ratio_active_oligos_highlighted.png"),native = T) -->
<!-- bad_example_2 <- readPNG(file.path(working_dir, "humanMPRA_L1a1_Neurons", "RNA_DNA_ratio_active_oligos_highlighted.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 3))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example_1, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 3)) -->
<!-- grid.raster(bad_example_2, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- ``` -->


<!-- ## RNA vs. DNA scatter plot - bcs level -->

<!-- Lorem Ipsum -->


<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T) -->
<!-- bad_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T) -->

<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 2))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- ``` -->

<!-- ## GC content bias in DNA counts -->

<!-- Lorem Ipsum -->


<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir, "humanMPRA_L4a1", "GC_content_bias_in_DNA.png"),native = T) -->
<!-- bad_example <- readPNG(file.path(working_dir, "humanMPRA_L3a2", "GC_content_bias_in_DNA.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 2))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- ``` -->

<!-- ## RNA/DNA ratio correlation between replicates -->

<!-- Lorem Ipsum -->



<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir, "humanMPRA_L3a2", "RNA_DNA_ratio_correlation_between_replicates.png"),native = T) -->
<!-- bad_example_1 <- readPNG(file.path(working_dir, "humanMPRA_L1a1", "RNA_DNA_ratio_correlation_between_replicates.png"),native = T) -->
<!-- bad_example_2 <- readPNG(file.path(working_dir, "humanMPRA_L1a1_Neurons", "RNA_DNA_ratio_correlation_between_replicates.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 3))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example_1, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 3)) -->
<!-- grid.raster(bad_example_2, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- ``` -->



<!-- ## RNA/DNA ratio correlation between replicates - ctrls -->

<!-- Lorem Ipsum -->


<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir, "humanMPRA_L3a2", "RNA_DNA_ratio_correlation_between_replicates_with_controls.png"),native = T) -->
<!-- bad_example_1 <- readPNG(file.path(working_dir, "humanMPRA_L1a1", "RNA_DNA_ratio_correlation_between_replicates_with_controls.png"),native = T) -->
<!-- bad_example_2 <- readPNG(file.path(working_dir, "humanMPRA_L1a1_Neurons", "RNA_DNA_ratio_correlation_between_replicates_with_controls.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 3))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example_1, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 3)) -->
<!-- grid.raster(bad_example_2, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- ``` -->

<!-- ## RNA/DNA ratio correlation between replicates - active vs not active -->

<!-- Lorem Ipsum -->


<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir, "humanMPRA_L3a2", "RNA_DNA_ratio_correlation_between_replicates_with_highlighted_oligos.png"),native = T) -->
<!-- bad_example_1 <- readPNG(file.path(working_dir, "humanMPRA_L1a1", "RNA_DNA_ratio_correlation_between_replicates_with_highlighted_oligos.png"),native = T) -->
<!-- bad_example_2 <- readPNG(file.path(working_dir, "humanMPRA_L1a1_Neurons", "RNA_DNA_ratio_correlation_between_replicates_with_highlighted_oligos.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 3))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example_1, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 3)) -->
<!-- grid.raster(bad_example_2, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- ``` -->

<!-- ## RNA/DNA ratio correlation between replicates - subgroup -->

<!-- Lorem Ipsum -->


<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T) -->
<!-- bad_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 2))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- ``` -->

<!-- ## RNA/DNA ratio correlation with previous experiments (same cell type) -->

<!-- Lorem Ipsum -->


<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T) -->
<!-- bad_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 2))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- ``` -->




<!-- ## RNA/DNA ratio correlation with previous experiments (allelic pairs) -->

<!-- Lorem Ipsum -->


<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T) -->
<!-- bad_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 2))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- ``` -->




<!-- ## RNA/DNA ratio correlation with previous experiments (allelic pairs) -->

<!-- Lorem Ipsum -->


<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir, "humanMPRA_L3a2", "allelic_pairs_correlation.png"),native = T) -->
<!-- bad_example_1 <- readPNG(file.path(working_dir, "humanMPRA_L1a1", "allelic_pairs_correlation.png"),native = T) -->
<!-- bad_example_2 <- readPNG(file.path(working_dir, "humanMPRA_L1a1_Neurons", "allelic_pairs_correlation.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 3))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example_1, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 3)) -->
<!-- grid.raster(bad_example_2, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- ``` -->




<!-- ## RNA/DNA ratio correlation between cell types (Ryder’s graph)Carly’s data -->

<!-- Lorem Ipsum -->


<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T) -->
<!-- bad_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 2))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- ``` -->




<!-- ## Activity statistic vs. RNA/DNA -->

<!-- Lorem Ipsum -->

<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir, "humanMPRA_L3a2", "activity_statistic_vs_RNA_DNA_ratio.png"),native = T) -->
<!-- bad_example_1 <- readPNG(file.path(working_dir, "humanMPRA_L1a1", "activity_statistic_vs_RNA_DNA_ratio.png"),native = T) -->
<!-- bad_example_2 <- readPNG(file.path(working_dir, "humanMPRA_L1a1_Neurons", "activity_statistic_vs_RNA_DNA_ratio.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 3))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example_1, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 3)) -->
<!-- grid.raster(bad_example_2, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- ``` -->




<!-- ## How to measure the droplet shape? -->

<!-- Lorem Ipsum -->


<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T) -->
<!-- bad_example <- readPNG(file.path(working_dir,"placeholder.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 2))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- ``` -->



<!-- ## Increasing min(DNA) threshold to decrease noise -->

<!-- Lorem Ipsum -->


<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- example <- readPNG(file.path(working_dir, "humanMPRA_L3a2", "min_DNA_threshold_noise_analysis.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 1))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- ``` -->



<!-- ## UMI complexity -->


<!-- Lorem Ipsum -->

<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir, "humanMPRA_L3a2", "UMI_complexity_histogram.png"),native = T) -->
<!-- bad_example <- readPNG(file.path(working_dir, "humanMPRA_L1a1", "UMI_complexity_histogram.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 2))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example, interpolate = FALSE) -->
<!-- popViewport() -->


<!-- ``` -->


<!-- ## Activity histogram -->

<!-- Lorem Ipsum -->

<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir, "humanMPRA_L3a2", "power_analysis_activity_histogram.png"),native = T) -->
<!-- bad_example_1 <- readPNG(file.path(working_dir, "humanMPRA_L1a1", "power_analysis_activity_histogram.png"),native = T) -->
<!-- bad_example_2 <- readPNG(file.path(working_dir, "humanMPRA_L1a1_Neurons", "power_analysis_activity_histogram.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 3))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example_1, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 3)) -->
<!-- grid.raster(bad_example_2, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- ``` -->




<!-- ## Cumulative RNA reads -->

<!-- Lorem Ipsum -->


<!-- ```{r,echo=FALSE} -->

<!-- grid.newpage() -->

<!-- good_example <- readPNG(file.path(working_dir, "humanMPRA_L3a2", "Cumulative RNA reads.png"),native = T) -->
<!-- bad_example <- readPNG(file.path(working_dir, "methMPRA", "Cumulative RNA reads.png"),native = T) -->


<!-- # Start new page and define layout -->
<!-- grid.newpage() -->
<!-- pushViewport(viewport(layout = grid.layout(1, 2))) -->

<!-- # Helper to specify location in layout -->
<!-- vplayout <- function(row, col) viewport(layout.pos.row = row, layout.pos.col = col) -->

<!-- # Draw both images in the layout without using print() -->
<!-- pushViewport(vplayout(1, 1)) -->
<!-- grid.raster(good_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- pushViewport(vplayout(1, 2)) -->
<!-- grid.raster(bad_example, interpolate = FALSE) -->
<!-- popViewport() -->

<!-- ``` -->















