[["index.html", "Quality Control Pipeline for Massively Parallel Reporter Assays (MPRAs) Overview Usage Scripts", " Quality Control Pipeline for Massively Parallel Reporter Assays (MPRAs) Omer Ronen 2026-01-13 Overview This pipeline is designed to help investigators evaluate the quality of their MPRA, quickly identify pitfalls, trace them to their source, and mitigate them. The scripts provided help ensure that the resulting MPRA data are suitable for robust statistical analysis and meaningful biological interpretation. This Bookdown accompanies our guide for best practices for MPRAs, which outlines recommendations for study design and interpretation [REF]. The manuscript covers all key experimental and analytical steps, including library design, and estimation of activity differential activity. It then describes core problems that often compromise MPRA quality, illustrating how these issues manifest in the data, and offering practical strategies for correction and optimization. Because each issue can influence multiple quality metrics, and each metric may be affected by several issues, the relationships form a many-to-many network. The figures presented below map these interdependencies and connect them to recommended diagnostic analyses. Usage A scheme of root problems, the impacted quality metrics and analyses for the cCRE-barcode association step. Root problems, impacted quality metrics and recommended analyses for the RNA and DNA quantification step. The quality control (QC) pipeline is organized into three chapters: QC of the barcode association step QC of activity estimation QC of differential activity estimation For each analysis, we provide an example of a successful and an unsuccessful dataset to illustrate how they manifest in the analysis. We welcome questions, feedback, or suggestions. Please feel free to reach out at david.gokhman [at] weizmann.ac.il. Scripts All of these analyses are integrated into the quality control pipeline described in this resource, with scripts provided here: [link]. "],["a-guide-for-running-the-analyses-notebook.html", "Chapter 1 A guide for running the analyses notebook 1.1 Associations 1.2 Activity", " Chapter 1 A guide for running the analyses notebook The QC pipeline is organized into two main chapters: Associations and Activity. Each chapter is accompanied by a dedicated script that allows the user to run all analyses presented in this book. Below, we describe the files required to run the pipeline. Note that not all files are required for every analysis, as each analysis has its own specific input requirements 1.1 Associations 1.1.1 Script Association_analysis.ipynb 1.1.2 Input The raw output files are generated during the processing of the MPRA raw data. These files serve as the inputs for Process_for_association_QC.py, which generates the following input files for this chapter: final_df: Barcode - cCRE association file, must include three columns: barcode, cCRE and match_count which represents the number of unique barcode - cCRE observations. This is the key file for association chapter association_before_minimum_associations: Barcode - cCRE association file before filtering for a minimal number of unique observations for each pair, must include three columns: barcode, cCRE and match_count which represents the number of unique barcode - cCRE observations association_before_promiscuity: Barcode - cCRE association file before filtering out barcodes that are associated with multiple cCREs, must include three columns: barcode, cCRE and match_count which represents the number of unique barcode - cCRE observations 1.1.3 Output Output figures are presented in this book in chapter 2 1.2 Activity 1.2.1 Script activity_analysis.ipynb 1.2.2 Input Most of the input files are generated during the processing of the MPRA raw data and the rest are created by combining the processed results with additional data sources comb_df: Each row represents a cCRE and has both activity data - statistic and p-value and RNA/DNA counts. This is the key file for the activity chapter activity_per_rep: Read counts data for each cCRE by replicates and combined UMI_counts: Read counts data for each UMI oligo_fasta: Fasta file that includes all cCREs tested std_analysis_df: DNA and RNA counts after outlier filterings of several degrees of strictness screen_df: Overlap of cCRE library with screen data, each row represents a cCRE and must have a screen annotation of the following: Distal enhancer like sequence, DNase-only, Proximal enhancer like sequence, Heterochromatin, Promoter like sequence, DNase-H3K4me3. This file can be created using bedtools tss_df: Distance of each cCRE from the nearest TSS, each row must include a numeric value that represents the distance. This file can be created using bedtools AI_df: Comparison of MPRA activity data with an AI model predictions for the same cCREs AI_comparative_df: Same as above but for differential activity downsampling_activity_path: A path for a folder that includes comb_df for each sampling parameter downsampling_ratio_path: A path for a folder that includes activity_per_rep for each sampling parameter comparative_df: MPRA comparative results, each row represents a locus allelic_pairs_df: MPRA quantitative data, each row represents a locus and includes data for both alleles of the locus 1.2.3 Output Output figures are presented in this book in chapter 3 "],["associations-qc.html", "Chapter 2 Associations QC 2.1 cCREs per BC 2.2 UMIs per association 2.3 BCs per cCRE 2.4 Retained cCREs 2.5 cCRE retention by sequencing depth 2.6 BCs per cCRE by sequencing depth 2.7 PCR bias - GC 2.8 PCR bias - G Stretches", " Chapter 2 Associations QC 2.1 cCREs per BC Goal: Assesses BC promiscuity Input file: association_before_promiscuity Evaluated metrics: Specificity Legend: A bar plot that shows the percentage of BCs (y axis) by their number of associated cCREs (x axis) Interpretation: The successful example showcases a highly specific experiment, where most of the BCs are associated with only one cCRE. The unsuccessful example showcases a problem where many BCs are associated with more than one oligo, suggesting a problem in specificity 2.2 UMIs per association Goal: assesses confidence in associations Input file: association_before_minimum_associations Evaluated metrics: Specificity Legend: A bar plot of the number of reads supporting each cCRE-BC pairing Interpretation: The successful example showcases a reliable experiment, where many BC-cCRE pairs are supported with a large number of reads. The unsuccessful example showcases a problem where many pairs only appear once, making it hard to trust the pairings 2.3 BCs per cCRE Goal: Assesses BC replicability Input file: final_df Evaluated metrics: Complexity (multiplicity &amp; uniformity) Legend: An empirical cumulative function (eCDF) of BCs per cCRE Interpretation: The successful example showcases a high BCs per cCRE statistics and a low percentage of cCREs with less than 10 BCs, suggesting high complexity and reliable associations. The unsuccessful example showcases a problem where many cCREs have low BC counts 2.4 Retained cCREs Goal: Assesses BC replicability Input file: final_df Evaluated metrics: Complexity (multiplicity &amp; uniformity) Legend: Retained cCREs per increasing cutoffs of BC number per cCRE Interpretation: The successful example showcases an experiment with high complexity, most of the cCREs are retained in high thresholds of minimal number of BC associations. The unsuccessful example showcases a low complexity experiment, when we filter for high BC associations per cCRE, most of the cCREs are filtered out 2.5 cCRE retention by sequencing depth Goal: Assesses whether sequencing depth is sufficient Input file: assoc_downsampling Evaluated metrics: Complexity (multiplicity &amp; uniformity) Legend: A scatter plot that shows the connection between the sampling parameter (x axis) and the percentage of retained cCREs. This analysis also includes predicted values to test whether additional sequening will help improving the results Interpretation: The successful example showcases an experiment with high complexity, predicted value for additional sequencing don’t improve the coverage significantly. The unsuccessful example showcases an experiment that can be improved by additional sequencing 2.6 BCs per cCRE by sequencing depth Goal: Assesses whether sequencing depth is sufficient Input file: Input file: assoc_downsampling Evaluated metrics: Complexity (multiplicity &amp; uniformity)** Legend: A box plot of the number of BCs per cCRE (y axis) as a function of the sampling parameter (x axis) Interpretation: The successful example showcases a plateau in the tested statistic. The unsuccessful example showcases an increase in the tested statistic, suggesting it can be improved by additional sequencing 2.7 PCR bias - GC Goal: Assesses GC content bias in PCR amplification Input file: final_df Evaluated metrics: Complexity (multiplicity &amp; uniformity) Legend: This figure includes two different plots with a shared x axis - GC% content bin. The box plot presents the number of reads for each cCRE and the line plot presents the number of cCREs in each bin. Data was binned in fixed sizes of 5% Interpretation: The successful example shows a relatively consistent number of reads per GC content, and PCR conditions that are optimized for the GC content levels of most cCREs (peaks are close to one another). The unsuccessful example shows both a strong amplification bias and suboptimal PCR conditions for the GC content levels of most cCREs 2.8 PCR bias - G Stretches Goal: Assesses G-stretches bias in PCR amplification Input file: final_df Evaluated metrics: Complexity (multiplicity &amp; uniformity) Legend: This figure includes two different plots with a shared x axis - G stretch length. The box plot presents the number of reads for each cCRE and the line plot presents the number of cCREs in each bin. Interpretation: The successful example shows a relatively consistent number of reads per G stretch length, suggesting no bias for short G stretch cCREs (peaks are close to one another). The unsuccessful example shows both a bias and suboptimal PCR conditions for long G stretch cCREs "],["activity-qc.html", "Chapter 3 Activity QC 3.1 Retained cCREs and barcodes 3.2 DNA counts vs GC content 3.3 Activity statistic vs count ratio 3.4 Differential activity statistic vs count ratio 3.5 Activity distribution 3.6 Differential activity distribution 3.7 P-value distribution 3.8 Volcano plot - FC vs Pval 3.9 BC retention by DNA/RNA sequencing depth 3.10 cCRE retention by DNA/RNA sequencing depth 3.11 Activity by sequencing depth 3.12 Cumulative RNA reads 3.13 Sample clustering 3.14 Correlation between replicates 3.15 Correlation of differential activity between replicates 3.16 Replicability by activity 3.17 Correlation between replicates (controls) 3.18 Cross-validation: allelic pairs 3.19 Cross-validaiton: cell types 3.20 Minimizing noise 3.21 Reproducibility by sequencing depth 3.22 RNA vs DNA 3.23 Activity of controls 3.24 Genomic annotations 3.25 Proximity to TSS 3.26 AI predictions vs activity 3.27 AI predictions vs differential activity", " Chapter 3 Activity QC 3.1 Retained cCREs and barcodes Goal: Assesses cCRE and BC coverage Input file: activity_per_rep Evaluated metrics: DNA Complexity, RNA Complexity: Legend: Percentage of cCREs and BCs present in the DNA and RNA quantification data compared with those observed in the association data Interpretation: The successful examples exhibits high percentages of retaiend BCs and cCREs in both RNA and DNA data. The unsuccessful example exhibits low coverage of cCREs in both DNA and RNA data and exteremly low coverage of BCs in the DNA data, suggesting low complexity 3.2 DNA counts vs GC content Goal: Assesses GC content bias in PCR amplification Input file: oligo_fasta, comb_df Evaluated metrics: DNA Complexity Legend: This figure includes two different plots with a shared x axis - GC% content bin. The box plot presents the number of reads for each cCRE and the histogram presents the number of cCREs in each bin. Data was binned in fixed sizes of 5% Interpretation: The successful example shows a relatively consistent number of reads per GC content, and PCR conditions that are optimized for the GC content levels of most cCREs (peaks are close to one another). The unsuccessful example shows both a strong amplification bias and suboptimal PCR conditions for the GC content levels of most cCREs 3.3 Activity statistic vs count ratio Goal: Assesses the correlation between log2(RNA/DNA) and the summary statistic of activity Input file: comb_df Evaluated metrics: DNA Complexity, RNA Complexity Legend: The scatter plot presents the correlation between the naive method of testing activity: log2(RNA/DNA) (x axis) and the more reliable summary statistic calculated by the pipeline (y axis) Interpretation: The successful example showcases an experiment with high complexity, reflected in the high correlation between the measurements. The unsuccessful example showcases an experiment with a relatively low correlation between measurements, suggesting low complexity 3.4 Differential activity statistic vs count ratio Goal: Input file: Evaluated metrics: Legend: Interpretation: 3.5 Activity distribution Goal: Assesses activity dynamic range, noise, and statistical power Input file: comb_df Evaluated metrics: DNA Complexity, RNA Complexity: Legend: An histogram of log2(RNA/DNA) of the tested cCREs. cCREs that are marked in red were determined to be active by the pipeline Interpretation: The successful example showcases a broad dynamic range, with most of the highly active cCREs detected as significantly active. The 1st unsuccessful example showcases a problem in the detection of activity, either because of high noise levels or the experiment being underpowered. The 2nd unsuccessful example showcases silencing, with cCREs that are unlikely to be truly active detected as significantly active 3.6 Differential activity distribution Goal: Assesses differential activity dynamic range, noise, and statistical power Input file: comparative_df Evaluated metrics: DNA Complexity, RNA Complexity Legend: An histogram of log2(RNA/DNA) difference between the two alleles for each locus. cCREs that are marked in red were determined to be differentialy active by the pipeline Interpretation: The successful example showcases a broad dynamic range of differential activity, with high fold-changes detected as significantly differential active. The unsuccessful example showcases under-detection of differential activity 3.7 P-value distribution Goal: Assesses the power of the statistical testing Input file: comb_df Evaluated metrics: DNA Complexity, RNA Complexity, Reproducibility, Dynamic range: Legend: A qq plot of the p-values assigned to each cCRE activity level compared to the expected p-values generated by a uniform distribution Interpretation: The successful example exhibits an experiment with sufficient statistical power, reflected in a deviation from the expected distribution with many significantly low p-values detected. The unsuccessful example showcases a deviation from the expected distribution but with an enrichment of high p-values, suggests under-powered testing 3.8 Volcano plot - FC vs Pval Goal: Assesses the power of the statistical testing Input file: comparative_df Evaluated metrics: DNA Complexity, RNA Complexity, Reproducibility, Dynamic range Legend: A volcano plot that shows the connection between the logFC value and the -log10(p-value) of the statistical test Interpretation: The successful example exhibits an experiment with sufficient statistical power to detect differential activity, every cCRE with a large enough logFC is detected as differential active. The unsuccessful example showcases an experiment with many cCREs with relatively large logFC that are not detected as differential active, suggesting lack of power in the analysis 3.9 BC retention by DNA/RNA sequencing depth Goal: Assesses whether sequencing depth is sufficient Input file: downsampling_ratio_path Evaluated metrics: DNA Complexity, RNA Complexity Legend: A line plot that exhibits the effect of sequencing depth (x axis) on the percentage of retained BCs (y axis). Sampling values higher than 1 represent predicted data points Interpretation: The successful example showcases sufficient sequencing depth, The baseline percentage is relatively high and additional sequencing doesn’t improve the percentage of retained BCs significantly. The unsuccessful example showcases an experiment with a low percentage of retained BCs and more sequencing increases significantly coverage suggesting additional sequencing is required 3.10 cCRE retention by DNA/RNA sequencing depth Goal: Assesses whether sequencing depth is sufficient Input file: downsampling_ratio_path Evaluated metrics: DNA Complexity, RNA Complexity Legend: A line plot that exhibits the effect of sequencing depth (x axis) on the percentage of retained cCREs (y axis). Sampling values higher than 1 represent predicted data points Interpretation: The successful example showcases sufficient sequencing depth, The baseline percentage is relatively high and additional sequencing doesn’t improve the percentage of retained cCREs significantly. The unsuccessful example showcases an experiment with a low percentage of retained cCREs and more sequencing increases significantly coverage suggesting additional sequencing is required 3.11 Activity by sequencing depth Goal: Assesses if sequencing depth is sufficient Input file: downsampling_activity_path Evaluated metrics: DNA Complexity, RNA Complexity Legend: A line plot that exhibits the effect of sequencing depth (x axis) on the percentage of active cCREs (y axis). Interpretation: The successful example showcases sufficient sequencing depth, reaching a plateau in the number of active cCREs detected, suggesting low noise levels. The unsuccessful example showcases an experiment where more sequencing decreases the number of active sequences detected, suggesting some of the currently detected active sequences are false positives 3.12 Cumulative RNA reads Goal: Assesses jackpotting Input file: comb_df Evaluated metrics: RNA Complexity, Dynamic range: Legend: cCREs are sorted by their RNA read counts and ranked relatively (x axis), they are assigned with a cumulative fraction value, calculated by the sum of all the RNA reads of all cCREs ranked above the cCRE and the cCRE RNA reads count, divided by the total number of reads Interpretation: The successful example showcases no jackpotting. The unsuccessful example showcases an experiment where most of the RNA reads come from just a few cCREs 3.13 Sample clustering Goal: Assesses reproducibility between samples Input file: cDNA_reads_by_cell_type Evaluated metrics: Reproducibility: mention in the bookdown: the importance of the percentage explained by the 1st and 2nd PCs. Legend: Principal component analysis (PCA) on samples Interpretation: The successful example showcases replicates clustering by cell type. The unsuccessful example showcases variation between replicates that is as large as that between cell types 3.14 Correlation between replicates Goal: Assesses reproducibility between replicates Input file: activity_per_rep Evaluated metrics: Reproducibility, Dynamic range: Legend: Scatter plot of the log2(RNA/DNA) values of each cCRE in two experimental replicates. Each data point is an hexagon that represents the cCRE density in the given values Interpretation: The successful example showcases a high correlation between replicates in more active cCREs. The unsuccessful example showcases no correlation 3.15 Correlation of differential activity between replicates Goal: Assesses reproducibility between replicates Input file: allelic_pairs_replicates_df Evaluated metrics: Reproducibility, Dynamic range Legend: Scatter plot of the log2(RNA/DNA) allelic difference values for each locus in two experimental replicates. Each data point is an hexagon that represents the cCRE density in the given values Interpretation: The successful example showcases correlation between replicates in more active cCREs. The unsuccessful example showcases no correlation 3.16 Replicability by activity Goal: Assesses the correlation in activity between replicates in active vs non-active cCREs Input file: activity_per_rep Evaluated metrics: Reproducibility Legend: A scatter plot of the correlation between replicates (y axis) as a function of log2(RNA/DNA) average value for each cCRE bin. Bins are in fixed ranges of size 1 Interpretation: The successful example showcases a higher correlation in active sequences, which further increases with activity level. The unsuccessful example showcases a low correlation in active sequences 3.17 Correlation between replicates (controls) Goal: Assesses reproducibility between replicates in positive and negative controls Input file: comb_df Evaluated metrics: Reproducibility Legend: Scatter plot of the log2(RNA/DNA) values of each cCRE in two experimental replicates. Positive controls are marked in green and negative controls are marked in red Interpretation: The successful examples showcases a high correlation between positive controls, and a low correlation between negatives controls. The unsuccessful example showcases low correlations in both 3.18 Cross-validation: allelic pairs Goal: Assesses reproducibility between allelic pairs Input file: allelic_pairs_df Evaluated metrics: Reproducibility Legend: Scatter plot of the log2(RNA/DNA) values of the allelic pairs of a locus. Each data point is an hexagon that represents the cCRE density in the given values Interpretation: The successful example showcases correlation between allelic pairs. The unsuccessful example showcases no correlation 3.19 Cross-validaiton: cell types Goal: Assesses reproducibility between different cell types Input file: cell_types_df Evaluated metrics: Reproducibility Legend: Scatter plot of the log2(RNA/DNA) values of each control sequence in two different cell types. Each data point is an hexagon that represents the cCRE density in the given values Interpretation: The successful example showcases correlation between cell types. The unsuccessful example showcases no correlation 3.20 Minimizing noise Goal: Removing outlier BCs and optimizing the threshold of minimum DNA counts to increase reproducibility Input file: different_std_threshold_analysis Evaluated metrics: Reproducibility: Legend: Each subplot is a scatter plot of correlation between replicates. The x axis represents the threshold for removing BCs and the y axis is the threshold of DNA reads Interpretation: The examples show an increase in correlations between replicates with increasing DNA cutoffss and outlier BC removal 3.21 Reproducibility by sequencing depth Goal: Assesses whether additional sequencing will improve reproducibility between replicates Input file: downsampling_activity_path, downsampling_ratio_path Evaluated metrics: Reproducibility Legend: A line plot of the correlation between replicates (y axis) as a function of the sampling parameter (y axis) Interpretation: The successful example showcases a scenario where additional sequencing will improve reproducibility, whereas the unsuccessful example showcases that the experiment has reached a plateau 3.22 RNA vs DNA Goal: Assesses if there is true activity in the experiment Input file: comb_df Evaluated metrics: Dynamic Range Legend: Scatter plot of RNA counts (y axis) vs. DNA counts (x axis) of each cCRE. Each data point is an hexagon that represents the cCRE density in the given values Interpretation: The successful example showcases many sequences with high RNA-to-DNA ratios (points above the diagonal). The 1st unsuccessful example showcases no activity (points are on the diagonal), and the 2nd unsuccessful example showcases silencing (points belot the diagonal) 3.23 Activity of controls Goal: Assesses the dynamic range of activity Input file: comb_df Evaluated metrics: Dynamic Range: Legend: Box plot of cCREs’ activity levels by control type - Positive, Negative or test cCREs Interpretation: The successful example showcases high activity of positive controls and low activity of negative controls. The unsuccessful example showcases similar activity of positive and negative controls 3.24 Genomic annotations Goal: Assesses concordance with endogenous signals of active chromatin marks Input file: screen_df Evaluated metrics: Concordance with endogenous signals Legend: A stacked Bar plot of the cCREs’ overlap with screen elements. cCREs were grouped by activity levels to six groups - Inactive and five activity quantiles Interpretation: The successful example showcases increased overlap with active chromatin marks as activity increases. The unsuccessful example shows no such increase 3.25 Proximity to TSS Goal: Assesses concordance with endogenous locations of cCREs Input file: tss_df Evaluated metrics: Concordance with endogenous signals Legend: A box plot of the distances of cCREs to the nearest TSS. cCREs were grouped by activity levels to six groups - Inactive and five activity quantiles Interpretation: The successful example showcases that more active cCREs tend to be closer to a TSS. The unsuccessful example shows no such trend 3.26 AI predictions vs activity Goal: Assesses the correlation between AI predictions of activity and MPRA results Input file: AI_df Evaluated metrics: Concordance with endogenous signals Legend: A scatter plot of the Experimentally measuerd activity (x axis) compared to the AI-predicted activity (y axis). Each data point is an hexagon that represents the cCRE density in the given values Interpretation: The successful example showcases a high correlation, and the unsuccessful example showcases little correlation 3.27 AI predictions vs differential activity Goal: Assesses the correlation between AI predictions of differential activity and MPRA results Input file: AI_comparative_df Evaluated metrics: Concordance with endogenous signals Legend: A scatter plot of the Experimentally measuerd activity (x axis) compared to the AI-predicted activity (y axis). Each data point is an hexagon that represents the cCRE density in the given values Interpretation: The successful example showcases a modest but consistent positive correlation, and the unsuccessful example showcases no correlation "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
