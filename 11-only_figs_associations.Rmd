# Associations QC



```{r, echo=FALSE}
library(png)
library(grid)
```




## cCREs per BC
**Goal:** Assesses BC promiscuity <br>
**Input file:** association_before_promiscuity<br>
**Evaluated metrics:** Specificity<br>

```{r echo=FALSE}
htmltools::tagList(
  htmltools::tags$div(
    style = "display:flex; justify-content:space-between; align-items:flex-start; gap:16px; width:100%;",

    htmltools::tags$div(
      style = "width:49%;",
      htmltools::tags$div(
        style = "text-align:center; margin-bottom:6px;",
        htmltools::tags$img(
          src = "external_figures/thumbs_up.svg",
          style = "width:60px; display:inline-block;"
        )
      ),
      htmltools::tags$img(
        src = "external_figures/PMID_38766054_Reilly/cCREs_per_BC.svg",
        style = "width:100%; display:block;"
      )
    ),

    htmltools::tags$div(
      style = "width:49%;",
      htmltools::tags$div(
        style = "text-align:center; margin-bottom:6px;",
        htmltools::tags$img(
          src = "external_figures/thumbs_down.svg",
          style = "width:60px; display:inline-block;"
        )
      ),
      htmltools::tags$img(
        src = "external_figures/Max_MPRA_run2/cCREs_per_BC_shuffled.svg",
        style = "width:100%; display:block;"
      )
    )
  )
)



```



**Legend:** A histogram of the number of cCREs per BC <br>
**Interpretation:** The successful example showcases a highly specific experiment, where most of the BCs are associated with only one cCRE. The unsuccessful example showcases a problem where many BCs are associated with more than one oligo, suggesting a problem in specificity <br>


## Reads per association
**Goal:** Assesses confidence in associations <br>
**Input file:** association_before_minimum_associations<br>
**Evaluated metrics:** Specificity<br>

```{r echo=FALSE}
htmltools::tagList(
  htmltools::tags$div(
    style = "display:flex; justify-content:space-between; align-items:flex-start; gap:16px; width:100%;",

    htmltools::tags$div(
      style = "width:49%;",
      htmltools::tags$div(
        style = "text-align:center; margin-bottom:6px;",
        htmltools::tags$img(
          src = "external_figures/thumbs_up.svg",
          style = "width:60px; display:inline-block;"
        )
      ),
      htmltools::tags$img(
        src = "external_figures/PMID_38766054_Reilly/UMIs_per_association.svg",
        style = "width:100%; display:block;"
      )
    ),

    htmltools::tags$div(
      style = "width:49%;",
      htmltools::tags$div(
        style = "text-align:center; margin-bottom:6px;",
        htmltools::tags$img(
          src = "external_figures/thumbs_down.svg",
          style = "width:60px; display:inline-block;"
        )
      ),
      htmltools::tags$img(
        src = "external_figures/Max_MPRA_run2/UMIs_per_association.svg",
        style = "width:100%; display:block;"
      )
    )
  )
)



```





**Legend:** The number of reads supporting each cCRE-BC pairing <br>
**Interpretation:** The successful example showcases a robust experiment, where BC-cCRE associations are supported by many reads. In the unsuccessful example, over half of the associations  appear only once. <br>



## BCs per cCRE



**Goal:** Assesses BC replicability <br>
**Input file:** final_df <br>
**Evaluated metrics:** Complexity (multiplicity & uniformity)<br>


```{r echo=FALSE}
htmltools::tagList(
  htmltools::tags$div(
    style = "display:flex; justify-content:space-between; align-items:flex-start; gap:16px; width:100%;",

    htmltools::tags$div(
      style = "width:49%;",
      htmltools::tags$div(
        style = "text-align:center; margin-bottom:6px;",
        htmltools::tags$img(
          src = "external_figures/thumbs_up.svg",
          style = "width:60px; display:inline-block;"
        )
      ),
      htmltools::tags$img(
        src = "external_figures/PMID_38766054_Reilly/Barcodes_per_cCRE.svg",
        style = "width:100%; display:block;"
      )
    ),

    htmltools::tags$div(
      style = "width:49%;",
      htmltools::tags$div(
        style = "text-align:center; margin-bottom:6px;",
        htmltools::tags$img(
          src = "external_figures/thumbs_down.svg",
          style = "width:60px; display:inline-block;"
        )
      ),
      htmltools::tags$img(
        src = "external_figures/Max_MPRA_run2/Barcodes_per_cCRE.svg",
        style = "width:100%; display:block;"
      )
    )
  )
)



```


**Legend:** An empirical cumulative function (eCDF) of BCs per cCRE <br>
**Interpretation:** The successful example showcases many BCs per cCRE and a low percentage of cCREs with fewer than 10 BCs, suggesting high complexity. The unsuccessful example showcases a problem where most cCREs have few BCs. <br>


## Retained cCREs
**Goal:** Assesses BC replicability <br>
**Input file:** final_df<br>
**Evaluated metrics:** Complexity (multiplicity & uniformity)<br>

```{r echo=FALSE}
htmltools::tagList(
  htmltools::tags$div(
    style = "display:flex; justify-content:space-between; align-items:flex-start; gap:16px; width:100%;",

    htmltools::tags$div(
      style = "width:49%;",
      htmltools::tags$div(
        style = "text-align:center; margin-bottom:6px;",
        htmltools::tags$img(
          src = "external_figures/thumbs_up.svg",
          style = "width:60px; display:inline-block;"
        )
      ),
      htmltools::tags$img(
        src = "external_figures/PMID_38766054_Reilly/Retained_cCREs.svg",
        style = "width:100%; display:block;"
      )
    ),

    htmltools::tags$div(
      style = "width:49%;",
      htmltools::tags$div(
        style = "text-align:center; margin-bottom:6px;",
        htmltools::tags$img(
          src = "external_figures/thumbs_down.svg",
          style = "width:60px; display:inline-block;"
        )
      ),
      htmltools::tags$img(
        src = "external_figures/Max_MPRA_run2/Retained_cCREs.svg",
        style = "width:100%; display:block;"
      )
    )
  )
)



```



**Legend:** Retained cCREs per increasing cutoffs of BC number per cCRE<br>
**Interpretation:** The successful example showcases a high-complexity experiment, in which most cCREs are retained even at stringent minimum barcode thresholds. The unsuccessful example showcases a low-complexity experiment, in which the majority of cCREs are lost when applying high BC-per-cCRE filters.<br>


## cCRE retention by sequencing depth
**Goal:** Assesses whether sequencing depth is sufficient<br>
**Input file:** assoc_downsampling<br>
**Evaluated metrics:** Complexity (multiplicity & uniformity)<br>

```{r echo=FALSE}
htmltools::tagList(
  htmltools::tags$div(
    style = "display:flex; justify-content:space-between; align-items:flex-start; gap:16px; width:100%;",

    htmltools::tags$div(
      style = "width:49%;",
      htmltools::tags$div(
        style = "text-align:center; margin-bottom:6px;",
        htmltools::tags$img(
          src = "external_figures/thumbs_up.svg",
          style = "width:60px; display:inline-block;"
        )
      ),
      htmltools::tags$img(
        src = "external_figures/L3a2_281122/Downsampling_Retained_cCREs.svg",
        style = "width:100%; display:block;"
      )
    ),

    htmltools::tags$div(
      style = "width:49%;",
      htmltools::tags$div(
        style = "text-align:center; margin-bottom:6px;",
        htmltools::tags$img(
          src = "external_figures/thumbs_down.svg",
          style = "width:60px; display:inline-block;"
        )
      ),
      htmltools::tags$img(
        src = "external_figures/Max_MPRA_run2/Downsampling_Retained_cCREs.svg",
        style = "width:100%; display:block;"
      )
    )
  )
)



```


**Legend:** Sequencing depth vs retained cCREs. Sequencing data is downsampled in order to assess whether we have reached saturation in the percentage of retained cCREs. Then, data is extrapolated to predict whether additional sequencing will help improve the results.<br>
**Interpretation:** The successful example showcases a high-complexity experiment: additional sequencing is not predicted to improve the percentage of retained cCREs. The unsuccessful example showcases an experiment where sequencing depth was suboptimal: additional sequencing is predicted to improve the percentage of retained cCREs.<br>


## BCs per cCRE by sequencing depth
**Goal:** Assesses whether sequencing depth is sufficient <br>
**Input file:** Input file: assoc_downsampling<br>
**Evaluated metrics:** Complexity (multiplicity & uniformity)<br>

```{r echo=FALSE}
htmltools::tagList(
  htmltools::tags$div(
    style = "display:flex; justify-content:space-between; align-items:flex-start; gap:16px; width:100%;",

    htmltools::tags$div(
      style = "width:49%;",
      htmltools::tags$div(
        style = "text-align:center; margin-bottom:6px;",
        htmltools::tags$img(
          src = "external_figures/thumbs_up.svg",
          style = "width:60px; display:inline-block;"
        )
      ),
      htmltools::tags$img(
        src = "external_figures/Max_MPRA_run2/Downsampling_Barcodes_per_cCRE.svg",
        style = "width:100%; display:block;"
      )
    ),

    htmltools::tags$div(
      style = "width:49%;",
      htmltools::tags$div(
        style = "text-align:center; margin-bottom:6px;",
        htmltools::tags$img(
          src = "external_figures/thumbs_down.svg",
          style = "width:60px; display:inline-block;"
        )
      ),
      htmltools::tags$img(
        src =  "external_figures/L3a2_281122/Downsampling_Barcodes_per_cCRE.svg",
        style = "width:100%; display:block;"
      )
    )
  )
)



```


**Legend:** A box plot of the number of BCs per cCRE (y axis) as a function of the downsampling parameter (x axis), i.e., the fraction of sequencing data used. <br>
**Interpretation:** In the successful example, sequencing depth was sufficient to capture library complexity. In the unsuccessful example, additional sequencing substantially increases the number of barcodes, indicating that the library has not yet been sequenced to saturation.<br>


## PCR bias - GC



**Goal:** Assesses GC content bias in PCR amplification <br>
**Input file:** final_df<br>
**Evaluated metrics:** Complexity (multiplicity & uniformity)<br>
```{r echo=FALSE}
htmltools::tagList(
  htmltools::tags$div(
    style = "display:flex; justify-content:space-between; align-items:flex-start; gap:16px; width:100%;",

    htmltools::tags$div(
      style = "width:49%;",
      htmltools::tags$div(
        style = "text-align:center; margin-bottom:6px;",
        htmltools::tags$img(
          src = "external_figures/thumbs_up.svg",
          style = "width:60px; display:inline-block;"
        )
      ),
      htmltools::tags$img(
        src = "external_figures/PMID_38766054_Reilly/PCR_bias_GC.svg",
        style = "width:100%; display:block;"
      )
    ),

    htmltools::tags$div(
      style = "width:49%;",
      htmltools::tags$div(
        style = "text-align:center; margin-bottom:6px;",
        htmltools::tags$img(
          src = "external_figures/thumbs_down.svg",
          style = "width:60px; display:inline-block;"
        )
      ),
      htmltools::tags$img(
        src =   "external_figures/Max_MPRA_run2/PCR_bias_GC.svg",
        style = "width:100%; display:block;"
      )
    )
  )
)



```

**Legend:** The number of reads (yellow box plots) and cCREs (green line) at various levels of GC content. Data was binned in fixed sizes of 5%. <br>
**Interpretation:** The successful example showcases a relatively consistent number of reads per GC content, as well as PCR conditions that are optimized for the most common GC content levels (peaks are close to one another). The unsuccessful example showcases both a strong amplification bias and suboptimal PCR conditions for the GC content levels of most cCREs.<br>





## PCR bias - G-stretches

**Goal:** Assesses G-stretches bias in PCR amplification<br>
**Input file:** final_df<br>
**Evaluated metrics:** Complexity (multiplicity & uniformity)<br>

```{r echo=FALSE}
htmltools::tagList(
  htmltools::tags$div(
    style = "display:flex; justify-content:space-between; align-items:flex-start; gap:16px; width:100%;",

    htmltools::tags$div(
      style = "width:49%;",
      htmltools::tags$div(
        style = "text-align:center; margin-bottom:6px;",
        htmltools::tags$img(
          src = "external_figures/thumbs_up.svg",
          style = "width:60px; display:inline-block;"
        )
      ),
      htmltools::tags$img(
        src = "external_figures/thylacine_biorxiv_Gallego_Romero/PCR_bias_G-stretches.svg",
        style = "width:100%; display:block;"
      )
    ),

    htmltools::tags$div(
      style = "width:49%;",
      htmltools::tags$div(
        style = "text-align:center; margin-bottom:6px;",
        htmltools::tags$img(
          src = "external_figures/thumbs_down.svg",
          style = "width:60px; display:inline-block;"
        )
      ),
      htmltools::tags$img(
        src =   "external_figures/humanMPRA_L4a2/PCR_bias_G-stretches.svg",
        style = "width:100%; display:block;"
      )
    )
  )
)



```


**Legend:** The number of reads (yellow box plots) and cCREs (green line) at various lengths of G-stretches.<br>
**Interpretation:** The successful example showcases a relatively consistent number of reads per G-stretch length. The unsuccessful example showcases both a strong amplification bias and suboptimal PCR conditions for the GC content levels of most cCREs (peaks do not overlap).<br>




